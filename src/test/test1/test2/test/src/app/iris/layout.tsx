import { Metadata } from 'next';

import ExoIrisContent from '~/app/iris/ExoIrisContent';
import { cms } from '~/cms';
import { ArrowLink, SecondaryHeader } from '~/components/ui';
import { getFirstItemInCollection } from '~/utils';
import { formatPageMeta } from '~/utils/server';

const getData = async () => {
  const response = await cms().iris(cms().defaultVariables);
  const topBanner = await cms().getEventBasedModal({
    ...cms().defaultVariables,
    id: '2lWgtBdFudHdHEMQZ9Op5J',
  });

  return {
    articles: response.articleCollection,
    page: getFirstItemInCollection(response.exoIrisCollection),
    topBanner: topBanner.crmEventBasedModal,
  };
};

const ExoIrisLayout = async (props: { children: React.ReactNode }) => {
  const { children } = props;
  const { topBanner } = await getData();

  return (
    <div data-accent-color="iris-blue">
      <SecondaryHeader
        heroText={topBanner?.heroText ?? ''}
        isModalEnabledOnSite={topBanner?.isModalEnabledOnSite ?? false}
        link={topBanner?.link ?? ''}
        logo={
          <svg viewBox="0 0 117 35" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g clipPath="url(#clip0_1784_16276)">
              <path
                d="M20.6415 4.232V6.338H4.22247V16.439H19.0815V18.545H4.22247V29.894H20.6415V32H1.92147V4.232H20.6415ZM39.1351 11.876L31.7641 21.665L39.5641 32H36.9511L34.4941 28.724C33.1291 26.852 31.7641 24.98 30.4771 23.264C29.1901 25.019 27.7861 26.891 26.4601 28.763L24.0031 32H21.4291L29.1901 21.665L21.8581 11.876H24.4321L27.0841 15.386C28.2541 16.985 29.4241 18.545 30.5161 20.105L33.9481 15.386L36.5611 11.876H39.1351ZM48.2388 32.468C42.7008 32.468 38.8788 28.256 38.8788 21.938C38.8788 15.62 42.7008 11.408 48.2388 11.408C53.8158 11.408 57.6378 15.62 57.6378 21.938C57.6378 28.256 53.8158 32.468 48.2388 32.468ZM48.2388 30.479C52.5678 30.479 55.3368 27.164 55.3368 21.938C55.3368 16.712 52.5678 13.397 48.2388 13.397C43.9488 13.397 41.1798 16.712 41.1798 21.938C41.1798 27.164 43.9488 30.479 48.2388 30.479Z"
                fill="currentColor"
              />
              <path
                d="M67.8225 32H65.5215V4.232H67.8225V32ZM80.5931 11.603C80.9441 11.603 81.2951 11.603 81.7241 11.642V13.748H80.7881C76.3031 13.748 73.7681 16.478 73.7681 20.729V32H71.5451V11.876H73.6511V16.088C74.7041 13.748 76.8881 11.603 80.5931 11.603ZM86.1668 9.068H83.7878V5.402H86.1668V9.068ZM86.1278 32H83.9048V11.876H86.1278V32ZM97.0773 32.468C91.8123 32.468 89.0043 30.011 88.7313 25.76H90.9933C91.2663 28.919 93.0213 30.557 97.0773 30.557C100.665 30.557 102.693 29.309 102.693 26.735C102.693 24.668 101.406 23.615 97.7403 22.952L95.6733 22.601C91.3833 21.821 89.3553 20.066 89.3553 16.907C89.3553 13.514 92.0463 11.408 96.5703 11.408C101.991 11.408 104.331 13.865 104.526 17.648H102.264C102.069 14.723 100.392 13.319 96.5703 13.319C93.4113 13.319 91.5783 14.606 91.5783 16.868C91.5783 19.13 93.2553 20.027 96.3363 20.612L98.3643 20.963C103.005 21.821 104.916 23.498 104.916 26.618C104.916 30.557 101.718 32.468 97.0773 32.468Z"
                data-fill-color="iris-blue"
              />
              <path
                d="M116.423 7.0136H115.525V2.4728H115.499L113.717 7.0136H113.149L111.367 2.4728H111.341V7.0136H110.443V1.5752H111.829L113.453 5.7068L115.05 1.5752H116.423V7.0136ZM109.334 2.3012H107.632V7.0136H106.734V2.3012H105.031V1.5752H109.334V2.3012Z"
                data-fill-color="iris-blue"
              />
            </g>
            <defs>
              <clipPath id="clip0_1784_16276">
                <rect width="117" height="35" fill="currenColor" />
              </clipPath>
            </defs>
          </svg>
        }
        mobileLogo={
          <svg viewBox="0 0 86 19" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M12.44 2.736H2.576V8.184H11.48V10.008H2.576V16.176H12.344V18H0.56V0.912H12.44V2.736ZM20.0951 11.664L24.8231 18H22.5671L21.8951 17.064C20.9111 15.672 19.9271 14.304 18.9911 13.032C18.0311 14.328 16.9991 15.72 16.0391 17.088L15.3911 18H13.1591L17.8871 11.664L13.3991 5.616H15.6551L16.6151 6.936C17.4311 8.04 18.2471 9.168 19.0151 10.296C19.8071 9.168 20.6471 7.992 21.4151 6.936L22.3511 5.616H24.5831L20.0951 11.664ZM30.7072 18.288C27.2272 18.288 24.7072 15.768 24.7072 11.808C24.7072 7.848 27.2272 5.328 30.7072 5.328C34.1872 5.328 36.7072 7.848 36.7072 11.808C36.7072 15.768 34.1872 18.288 30.7072 18.288ZM30.7072 16.56C33.1072 16.56 34.6912 14.808 34.6912 11.808C34.6912 8.808 33.1072 7.056 30.7072 7.056C28.3072 7.056 26.7232 8.808 26.7232 11.808C26.7232 14.808 28.3072 16.56 30.7072 16.56ZM43.685 18V0.912H45.701V18H43.685ZM54.5058 5.424C54.6978 5.424 54.8898 5.424 55.1538 5.448V7.296H54.6738C52.2018 7.296 50.6178 8.544 50.6178 10.944V18H48.6978V5.616H50.5218V7.8C51.2178 6.504 52.4898 5.424 54.5058 5.424ZM56.8758 3.744V1.392H58.9158V3.744H56.8758ZM56.9478 18V5.616H58.8678V18H56.9478ZM66.1205 18.288C62.9765 18.288 61.0565 16.968 60.8645 14.064H62.8085C63.0245 15.936 63.9365 16.632 66.1205 16.632C68.2085 16.632 69.0965 15.936 69.0965 14.712C69.0965 13.608 68.4245 13.104 66.2645 12.696L65.1125 12.48C62.4245 11.976 61.2485 10.752 61.2485 8.832C61.2485 6.72 62.9285 5.328 65.7605 5.328C69.0725 5.328 70.7525 6.792 70.8005 9.432H68.8805C68.7845 7.512 67.6565 6.984 65.7605 6.984C64.1045 6.984 63.1685 7.656 63.1685 8.808C63.1685 9.984 64.0805 10.416 65.6645 10.728L66.7685 10.944C69.8165 11.544 71.0405 12.576 71.0405 14.592C71.0405 16.944 69.1685 18.288 66.1205 18.288ZM74.0244 1.872V0.912H78.9684V1.872H77.0244V7.008H75.9684V1.872H74.0244ZM84.5604 0.912H85.7604V7.008H84.7284V4.992C84.7284 4.464 84.7284 3.792 84.7524 3.048C84.7044 3.168 84.6564 3.312 84.5844 3.456L83.1684 7.008H82.3284L80.8884 3.456L80.7204 3.024C80.7444 3.768 80.7444 4.464 80.7444 4.992V7.008H79.7124V0.912H80.9124L82.2804 4.296C82.4484 4.728 82.6164 5.184 82.7364 5.568L83.2404 4.2L84.5604 0.912Z"
              data-fill-color="iris-blue"
            />
          </svg>
        }
        logoLink={{ href: '/iris' }}
        links={[
          { href: '/iris', label: 'Why Exo Iris' },
          { href: '/iris-gallery', label: 'Gallery' },
          { href: '/iris/integrations', label: 'Integrations' },
          { href: '/iris/specs', label: 'Tech Specs' },
          { href: '/iris#pricing', label: 'Pricing' },
        ]}
        cta={{ isExternal: true, href: 'https://store.exo.inc/', label: 'Buy Now' }}
        secondaryCta={{ href: '/iris/demo', label: 'Demo' }}
      />
      {children}
    </div>
  );
};

export default ExoIrisLayout;
